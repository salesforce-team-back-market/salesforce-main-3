<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Action_Send_EN_Last_Chance_MOP_Email</name>
        <label>Action - Send EN Last Chance MOP Email</label>
        <locationX>2312</locationX>
        <locationY>1728</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Decision_on_merchant_empty_limitation_0</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Decision_on_merchant_empty_limitation_0</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>TextTemplate_EN_MOP_LastChance_Body</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>merchant.no-reply@backmarket.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>TextTemplate_EN_MOP_LastChance_Subject</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Action_Send_EN_MP_MOP_Email</name>
        <label>Action - Send EN MP MOP Email</label>
        <locationX>3632</locationX>
        <locationY>1608</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>TextTemplate_EN_MOP_MP_Body</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>merchant.no-reply@backmarket.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>TextTemplate_EN_MOP_MP_Subject</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Action_Send_FR_Last_Chance_MOP_Email</name>
        <label>Action - Send FR Last Chance MOP Email</label>
        <locationX>1520</locationX>
        <locationY>1728</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <connector>
            <targetReference>Decision_on_merchant_empty_limitation_0</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Decision_on_merchant_empty_limitation_0</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>TextTemplate_FR_MOP_LastChance_Body</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>merchant.no-reply@backmarket.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>TextTemplate_FR_MOP_LastChance_Subject</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Action_Send_FR_MP_MOP_Email</name>
        <label>Action - Send FR MP MOP Email</label>
        <locationX>3104</locationX>
        <locationY>1608</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>TextTemplate_FR_MOP_MP_Body</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>merchant.no-reply@backmarket.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>TextTemplate_FR_MOP_MP_Subject</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>51.0</apiVersion>
    <assignments>
        <name>Add_all_contacts_to_final_list</name>
        <label>Add all contacts to final list</label>
        <locationX>2125</locationX>
        <locationY>1008</locationY>
        <assignmentItems>
            <assignToReference>Var_FinalListForInvoice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_on_all_contacts.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Tech_count_contact</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Is_limit_reached_0_0_0_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_BizDev_Email_address_0_0</name>
        <label>Add BizDev Email address</label>
        <locationX>2906</locationX>
        <locationY>1248</locationY>
        <assignmentItems>
            <assignToReference>Var_FinalListForInvoice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>BizDev_Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_FinalListForInvoice</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>legal-sellers@backmarket.com</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_on_Stage</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Quality_contacts_to_final_list</name>
        <label>Add Quality contacts to final list</label>
        <locationX>2902</locationX>
        <locationY>888</locationY>
        <assignmentItems>
            <assignToReference>Var_FinalListForInvoice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_on_Quality_contacts.Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Tech_count_contact</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Var_FinalListForInvoice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Is_limit_reached_0_0_0_0_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Sales_limitation_before_alert</name>
        <label>Assign Sales limitation before alert</label>
        <locationX>1784</locationX>
        <locationY>2100</locationY>
        <assignmentItems>
            <assignToReference>Limitation_before_alert</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.MOP_Alert__r.Business_Name__r.Sales_limitation__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_merchant_limitation_before_alert_0_0</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Decision_on_bypass_flow</name>
        <label>Decision on bypass flow</label>
        <locationX>1274</locationX>
        <locationY>288</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Category_should_be_bypass</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Category__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>MacBook</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Category__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Tablets</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Category__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Smartphone</stringValue>
                </rightValue>
            </conditions>
            <label>Category should be bypass</label>
        </rules>
        <rules>
            <name>User_dont_bypass</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$User.ByPassFlow__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Filter_on_alert_recordtype_and_stage</targetReference>
            </connector>
            <label>User dont bypass</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_on_merchant_empty_limitation_0</name>
        <label>Decision on merchant empty limitation</label>
        <locationX>1916</locationX>
        <locationY>1980</locationY>
        <defaultConnector>
            <targetReference>Update_merchant_limitation_to_apply_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Rollup_1_and_limitation_is_null_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.LimitationBeforeAlert__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Sales_limitation_before_alert</targetReference>
            </connector>
            <label>Sales limitation before alert is null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Decision_on_Stage</name>
        <label>Decision on Stage</label>
        <locationX>2906</locationX>
        <locationY>1368</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Stage_is_Last_Chance</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Last chance</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_MOP_Alert_Last_Chance</targetReference>
            </connector>
            <label>Stage is Last Chance</label>
        </rules>
        <rules>
            <name>Stage_is_Monitoring_period</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Monitoring Period</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Merchant_Zone_0_0</targetReference>
            </connector>
            <label>Stage is Monitoring period</label>
        </rules>
    </decisions>
    <decisions>
        <name>Do_we_have_Quality_contacts</name>
        <label>Do we have Quality contacts</label>
        <locationX>1991</locationX>
        <locationY>648</locationY>
        <defaultConnector>
            <targetReference>Loop_on_Quality_contacts</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_0_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Quality_Contacts</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_All_Contacts</targetReference>
            </connector>
            <label>No</label>
        </rules>
    </decisions>
    <decisions>
        <name>Filter_on_alert_recordtype_and_stage</name>
        <label>Filter on alert recordtype and stage</label>
        <locationX>2466</locationX>
        <locationY>408</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>RecordType_is_MOP_and_stage_last_chance_or_MOP</name>
            <conditionLogic>1 AND (2 OR 3)</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.RecordTypeId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>$Setup.Special_Process_Record_Types_Ids__c.MOP_Alert__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Last chance</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Stage__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Monitoring Period</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Quality_Contacts</targetReference>
            </connector>
            <label>RecordType is MOP and stage last chance or MOP</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_limit_reached_0_0_0_0</name>
        <label>Is limit reached</label>
        <locationX>2125</locationX>
        <locationY>1128</locationY>
        <defaultConnector>
            <targetReference>Add_BizDev_Email_address_0_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Limit_isn_t_reached_0_0_0_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Tech_count_contact</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <numberValue>3.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_on_all_contacts</targetReference>
            </connector>
            <label>Limit isn&apos;t reached</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_limit_reached_0_0_0_0_0</name>
        <label>Is limit reached</label>
        <locationX>2902</locationX>
        <locationY>1008</locationY>
        <defaultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Add_BizDev_Email_address_0_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Limit_isn_t_reached_0_0_0_0_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Tech_count_contact</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <numberValue>3.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_on_Quality_contacts</targetReference>
            </connector>
            <label>Limit isn&apos;t reached</label>
        </rules>
    </decisions>
    <decisions>
        <name>Merchant_Zone_0</name>
        <label>Merchant Zone</label>
        <locationX>1916</locationX>
        <locationY>1608</locationY>
        <defaultConnector>
            <targetReference>Action_Send_EN_Last_Chance_MOP_Email</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>FR_or_BE_Zone_0</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>fr-fr</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>fr-be</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Action_Send_FR_Last_Chance_MOP_Email</targetReference>
            </connector>
            <label>FR or BE Zone</label>
        </rules>
        <rules>
            <name>US_zone_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>en-us</stringValue>
                </rightValue>
            </conditions>
            <label>US zone</label>
        </rules>
    </decisions>
    <decisions>
        <name>Merchant_Zone_0_0</name>
        <label>Merchant Zone</label>
        <locationX>3368</locationX>
        <locationY>1488</locationY>
        <defaultConnector>
            <targetReference>Action_Send_EN_MP_MOP_Email</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>FR_or_BE_Zone_0_0</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>fr-fr</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>fr-be</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Action_Send_FR_MP_MOP_Email</targetReference>
            </connector>
            <label>FR or BE Zone</label>
        </rules>
        <rules>
            <name>US_zone_0_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.MOP_Alert__r.Business_Name__r.Zone__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>en-us</stringValue>
                </rightValue>
            </conditions>
            <label>US zone</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>Alert_LastChance_Limitation_Sales_formula</name>
        <dataType>Number</dataType>
        <expression>if(
(({!$Record.MOP_Alert__r.Business_Name__r.Cumulated_sales_last_30_days__c} * 0.3)/30)&gt;5,(({!$Record.MOP_Alert__r.Business_Name__r.Cumulated_sales_last_30_days__c} * 0.3)/30) , 5)</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>Alert_limitation_sales_formula</name>
        <dataType>Number</dataType>
        <expression>if((({!$Record.MOP_Alert__r.Business_Name__r.Cumulated_sales_last_30_days__c} * 2)/30)&gt;5,(({!$Record.MOP_Alert__r.Business_Name__r.Cumulated_sales_last_30_days__c} * 2)/30) , 5)</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>BizDev_Email</name>
        <dataType>String</dataType>
        <expression>if( TEXT({!$Record.MOP_Alert__r.Business_Name__r.Owner.Team__c})= &apos;SSM Back Watch E.U.&apos;, &apos;backwatch@backmarket.com&apos;, 
if( TEXT({!$Record.MOP_Alert__r.Business_Name__r.Owner.Team__c})= &apos;Activation E.U.&apos;, &apos;activation-eu@backmarket.com&apos;, 
if( TEXT({!$Record.MOP_Alert__r.Business_Name__r.Owner.Team__c})= &apos;SSM Back Watch U.S.&apos;, &apos;sam@backmarket.com&apos;,
if( TEXT({!$Record.MOP_Alert__r.Business_Name__r.Owner.Team__c})= &apos;SSM Selfcare E.U.&apos;, &apos;selfcare@backmarket.com&apos;,
{!$Record.MOP_Alert__r.Business_Name__r.Owner.Email}))))</expression>
    </formulas>
    <formulas>
        <name>MP_Creation_Body</name>
        <dataType>String</dataType>
        <expression>&quot;New Monitoring Period created&quot;</expression>
    </formulas>
    <formulas>
        <name>SalesLimitation_LC</name>
        <dataType>Number</dataType>
        <expression>if({!Alert_LastChance_Limitation_Sales_formula}&gt;{!$Record.MOP_Alert__r.Business_Name__r.Sales_limitation__c},{!$Record.MOP_Alert__r.Business_Name__r.Sales_limitation__c},{!Alert_LastChance_Limitation_Sales_formula})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>Tech_ReasonForLimitation</name>
        <dataType>String</dataType>
        <expression>if(ISPICKVAL({!$Record.MOP_Alert__r.Business_Name__r.Reason_for_last_Sales_limitation__c},&quot;&quot;), &quot;No limitation&quot;, TEXT({!$Record.MOP_Alert__r.Business_Name__r.Reason_for_last_Sales_limitation__c}))</expression>
    </formulas>
    <interviewLabel>Mystery Order - After save flow - Alert added as Last chance or MP {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Mystery Order - After save flow - Alert added as Last chance or MP</label>
    <loops>
        <name>Loop_on_all_contacts</name>
        <label>Loop on all contacts</label>
        <locationX>1256</locationX>
        <locationY>888</locationY>
        <collectionReference>Get_All_Contacts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_all_contacts_to_final_list</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Add_BizDev_Email_address_0_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_on_Quality_contacts</name>
        <label>Loop on Quality contacts</label>
        <locationX>2726</locationX>
        <locationY>768</locationY>
        <collectionReference>Get_Quality_Contacts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Quality_contacts_to_final_list</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Add_BizDev_Email_address_0_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_All_Contacts</name>
        <label>Get All Contacts</label>
        <locationX>1256</locationX>
        <locationY>768</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_on_all_contacts</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.MOP_Alert__r.Business_Name__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Email</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Active</stringValue>
            </value>
        </filters>
        <filters>
            <field>HasOptedOutOfEmail</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Quality_Contacts</name>
        <label>Get Quality Contacts</label>
        <locationX>1991</locationX>
        <locationY>528</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Do_we_have_Quality_contacts</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AccountId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.MOP_Alert__r.Business_Name__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Email</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>TECH_Role_contain_quality_business__c</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Quality</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Active</stringValue>
            </value>
        </filters>
        <filters>
            <field>HasOptedOutOfEmail</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Contact</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_merchant_limitation_before_alert_0_0</name>
        <label>Update merchant limitation before alert</label>
        <locationX>1784</locationX>
        <locationY>2220</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.MOP_Alert__r.Business_Name__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>LimitationBeforeAlert__c</field>
            <value>
                <elementReference>Limitation_before_alert</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Reason_for_last_Sales_limitation__c</field>
            <value>
                <stringValue>QUALITY_LEGAL_AND_SAFETY_ISSUE</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sales_limitation__c</field>
            <value>
                <elementReference>SalesLimitation_LC</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Tech_Reason_Limitation_Before_Alert__c</field>
            <value>
                <elementReference>Tech_ReasonForLimitation</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_merchant_limitation_to_apply_0</name>
        <label>Update merchant limitation to apply</label>
        <locationX>2048</locationX>
        <locationY>2100</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.MOP_Alert__r.Business_Name__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Reason_for_last_Sales_limitation__c</field>
            <value>
                <stringValue>QUALITY_LEGAL_AND_SAFETY_ISSUE</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sales_limitation__c</field>
            <value>
                <elementReference>SalesLimitation_LC</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_MOP_Alert_Last_Chance</name>
        <label>Update MOP Alert - Last Chance</label>
        <locationX>1916</locationX>
        <locationY>1488</locationY>
        <connector>
            <targetReference>Merchant_Zone_0</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Merchant_Zone_0</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.MOP_Alert__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>AlertLimitation__c</field>
            <value>
                <elementReference>Alert_LastChance_Limitation_Sales_formula</elementReference>
            </value>
        </inputAssignments>
        <object>Alert__c</object>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>MOP_Alert__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Mystery_Order__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>Decision_on_bypass_flow</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>TextTemplate_EN_MOP_LastChance_Body</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Hello {!$Record.MOP_Alert__r.Business_Name__r.Name},&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We are writing to inform you that your recent mystery order results on Back Market were critically lower than the quality standards outlined in the Quality Charter. Mystery orders are a way for us to randomly verify that Sellers are complying with their obligations under the sellers Terms and Conditions and the schedules thereto, in particular the Quality Charter.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Please find attached the report link explaining the detail of the mystery order: {!$Record.Link_to_the_MO__c}&lt;/p&gt;&lt;p&gt;Please find the reason(s) for the failure of your mystery order: {!$Record.Reason_for_failure__c}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We thank you to remedy this situation in the best delay, and to meet the expected quality standards within 30 days. During this delay, your sales account will be limited to {!$Record.MOP_Alert__r.AlertLimitation__c} sales per day (i.e. approximately 30% of your average daily sales volume made over the last 30 days), provided that you are not already subject to another stricter sales restriction during this period, in accordance with article 17 of our sellers T&amp;amp;Cs.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;After this delay, we will place a new mystery order on your account. In the event that its results are not satisfactory (Inspection score below 80% or a critical quality standard is not met), we will close your account and our business relationship shall terminate, as provided for under Articles 12 and 18.2 of the Terms and Conditions.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;For more information about Mystery order tests and scoring, as well as tools and levers to improve your refurbishing and testing processes, please consult the seller Support Center (find the link at the bottom).&lt;/p&gt;&lt;p&gt;Your Back Market contact is available to work with you to clarify and analyze the situation and jointly build an action plan to address issues.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We value your presence on our platform as an esteemed partner, and we sincerely hope we can resolve the situation and avoid closing your account. Please feel free to reach out if you have additional questions.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Sincerely,&amp;nbsp;&lt;/p&gt;&lt;p&gt;Back Market&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://merchant-support.backmarket.com/hc/en-gb/articles/4407217322130&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;https://merchant-support.backmarket.com/hc/en-gb/articles/4407217322130&lt;/a&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_EN_MOP_LastChance_Subject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.MOP_Alert__r.Business_Name__r.Back_Office_PK__c} - {!$Record.MOP_Alert__r.Business_Name__r.Name} - Feedback Mystery Order - Last chance to meet Back Market quality standards</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_EN_MOP_MP_Body</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Hello {!$Record.MOP_Alert__r.Business_Name__r.Name},&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We are writing to inform you that your recent mystery order on Back Market did not meet the quality standards outlined in the Quality Charter. Mystery orders are a way for us to randomly verify that Sellers are complying with their obligations under the sellers Terms and Conditions and the schedules thereto, in particular the Quality Charter.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Please find attached the report link summarizing the details of your mystery order: {!$Record.Link_to_the_MO__c}&lt;/p&gt;&lt;p&gt;Please find the reason(s) for the failure of your mystery order: {!$Record.Reason_for_failure__c}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We invite you to remedy this situation in the best delay, and by 30 days at the latest.&amp;nbsp;&lt;/p&gt;&lt;p&gt;After this delay, we will place a new mystery order on your account. In the event that its results are not satisfactory (Inspection score below 80% or a critical quality standard is not met), your sales capacity will automatically be limited to a stricter percentage of your sales volume, in accordance with articles 12 and 17 of our sellers T&amp;amp;Cs. We hope no limitation will be necessary, as we view you as a valuable partner on our platform.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;For more information about Mystery order tests and scoring, as well as tools and levers to improve your refurbishing and testing processes, please consult the seller Support Center (find the link at the bottom).&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Your Back Market contact is available to work with you to clarify and analyze the situation and jointly build an action plan to address issues.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Sincerely,&amp;nbsp;&lt;/p&gt;&lt;p&gt;Back Market&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://merchant-support.backmarket.com/hc/en-gb/articles/4407217322130&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;https://merchant-support.backmarket.com/hc/en-gb/articles/4407217322130&lt;/a&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_EN_MOP_MP_Subject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.MOP_Alert__r.Business_Name__r.Back_Office_PK__c} - {!$Record.MOP_Alert__r.Business_Name__r.Name} - Feedback Mystery Order - Monitoring to meet Back Market quality standards</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_FR_MOP_LastChance_Body</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Bonjour {!$Record.MOP_Alert__r.Business_Name__r.Name},&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Cet email a pour but de vous informer que la récente commande mystère à laquelle vous avez été sujet sur Back Market est significativement en dessous des normes de qualité décrites dans la Charte Qualité. Les commandes mystères sont un moyen pour nous de contrôler aléatoirement le respect par les Vendeurs de leurs obligations résultant de nos conditions générales vendeurs et leurs annexes, en particulier la Charte Qualité.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Vous trouverez ci-dessous le détail de l’analyse de votre commande mystère: {!$Record.Link_to_the_MO__c}&lt;/p&gt;&lt;p&gt;ainsi que les raisons de son échec: {!$Record.Reason_for_failure__c}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Nous vous remercions de remédier à cette situation et de respecter les&amp;nbsp;normes de qualité attendues dans un délai de 30 jours. Pendant ce délai,&amp;nbsp;votre compte vendeur sera, conformément à l’article 17 de nos conditions générales vendeurs, limité à {!$Record.&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;MOP_Alert__r.&lt;/span&gt;AlertLimitation__c} ventes par jour (soit environ 30% de votre volume de ventes quotidien moyen réalisé au cours des 30 derniers jours), sous réserve que vous ne soyez pas déjà sujet à aucune autre restriction similaire sur cette période.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;A l’issue de ce délai de 30 jours, nous effectuerons une nouvelle commande mystère. Dans le cas où le score final serait en dessous de 80% ou qu’une norme qualité importante ne serait pas respectée, nous fermerons votre compte vendeur sur notre plateforme et notre relation commerciale prendra fin, comme le prévoient les articles 12 et 18.2 de nos CGV. Nous espérons sincèrement que nous n&apos;en arriverons pas là et sommes à votre disposition pour répondre à toute question.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Pour plus d&apos;informations sur les commandes mystères ainsi que les outils et leviers pour améliorer vos processus de reconditionnement et de test, veuillez consulter notre centre d’assistance marchands le seller Support Center (veuillez trouver le lien en fin de mail).&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Votre contact Back Market est également disponible pour travailler avec vous afin d&apos;analyser la situation et d&apos;élaborer conjointement un plan d&apos;action pour résoudre les problèmes rencontrés.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Sincèrement,&amp;nbsp;&lt;/p&gt;&lt;p&gt;Back Market&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://merchant-support.backmarket.com/hc/fr/articles/4407217322130&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;https://merchant-support.backmarket.com/hc/fr/articles/4407217322130&lt;/a&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_FR_MOP_LastChance_Subject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.MOP_Alert__r.Business_Name__r.Back_Office_PK__c} - {!$Record.MOP_Alert__r.Business_Name__r.Name} - Feedback Mystery Order - Dernière chance pour répondre aux normes de qualité Back Market</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_FR_MOP_MP_Body</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Bonjour {!$Record.MOP_Alert__r.Business_Name__r.Name},&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Cet email a pour but de vous informer que la récente commande mystère à laquelle vous avez été sujet sur Back Market conformément à nos conditions générales de vente ne répond pas aux normes de qualité décrites dans la Charte Qualité. Les commandes mystères sont un moyen pour nous de contrôler aléatoirement le respect par les Vendeurs de leurs obligations résultant de nos conditions générales vendeurs et leurs annexes, en particulier la Charte Qualité.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Vous trouverez ci-dessous le détail de l’analyse de votre commande mystère:&lt;/p&gt;&lt;p&gt;{!$Record.Link_to_the_MO__c}&lt;/p&gt;&lt;p&gt;ainsi que les raisons de son échec: {!$Record.Reason_for_failure__c}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Nous vous invitons à remédier à ces manquements dans les meilleurs délais, et au plus tard sous trente jours.&amp;nbsp;&lt;/p&gt;&lt;p&gt;Passé ce délai, nous effectuerons une nouvelle commande mystère. Dans le cas où le score final serait en dessous de 80%, ou qu’une norme qualité importante ne serait alors pas respectée, votre volume de vente sera automatiquement limité, conformément aux articles 12 et 17 de nos conditions générales vendeurs.&amp;nbsp;Nous espérons qu&apos;aucune limitation ne sera nécessaire, car nous considérons votre compte comme un partenaire précieux sur la plateforme.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Pour plus d&apos;informations sur les commandes mystères ainsi que les outils et leviers pour améliorer vos processus de reconditionnement et de test, veuillez consulter notre centre d’assistance marchands le seller Support Center (veuillez trouver le lien en fin de mail).&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Votre contact Back Market est également disponible pour travailler avec vous afin d&apos;analyser la situation et d&apos;élaborer conjointement un plan d&apos;action pour résoudre les problèmes rencontrés.&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Sincèrement,&amp;nbsp;&lt;/p&gt;&lt;p&gt;Back Market&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://merchant-support.backmarket.com/hc/fr/articles/4407217322130&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;https://merchant-support.backmarket.com/hc/fr/articles/4407217322130&lt;/a&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>TextTemplate_FR_MOP_MP_Subject</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.MOP_Alert__r.Business_Name__r.Back_Office_PK__c} - {!$Record.MOP_Alert__r.Business_Name__r.Name} - Feedback Commande Mystère - Actions pour répondre aux normes de qualité Back Market</text>
    </textTemplates>
    <variables>
        <name>Contact_to_email</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>ContactsForEmailDorotea1</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>ContactsForEmailDorotea2</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>Current_Alert_to_update</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Alert__c</objectType>
    </variables>
    <variables>
        <name>Email_cannot_be_sent</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>FinalListForInvoice</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Contact</objectType>
    </variables>
    <variables>
        <name>Limitation_before_alert</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>Merchant_To_Update</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <name>Notification_type_id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Recipient_Ids</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Tech_count_contact</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>Var_FinalListForInvoice</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>VariableCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
